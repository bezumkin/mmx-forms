import{d as defineComponent,r as ref,c as computed,a5 as resolveComponent,o as openBlock,g as createBlock,w as withCtx,u as unref,a as createElementBlock,v as mergeProps,N as isRef,G as Transition,$ as createApp}from"./vue-Cn8r9y3J.js";import{v as vueform}from"./vueform-CIRLp5Lp.js";import{s as src_default}from"./vue-toastification-BmNyhvTg.js";import{u as useLexicon,f as usePost,h as useToastSuccess,v as vueFormConfig,t as toastOptions}from"./common.config-6jiFmk43.js";import"./axios-Cm0UX6qg.js";import"./moment-Cl4UOzQZ.js";import"./popperjs-CBZXh9ac.js";import"./wnumb-BOjvQ4jq.js";import"./trix-ul_qCPMg.js";import"./nouislider-dfTmBPAg.js";import"./vueform-locales-C8ccJXXi.js";const _hoisted_1=["innerHTML"],_sfc_main=defineComponent({__name:"app",props:{id:{type:String,required:!0},schema:{type:Object,default(){return{}}},locale:{type:String,default:"en"}},setup(__props){const props=__props,record=ref({}),loading=ref(!1),form=ref(),formKey=ref(props.id),msgSuccess=useLexicon("success.form.submitted"),msgAction=ref(),properties=computed(()=>{const e={endpoint:!1,formKey:formKey.value,locale:props.locale,loading,onSubmit};return"schema"in props.schema?{...props.schema,...e}:{...e,schema:props.schema}});async function onSubmit(){loading.value=!0;try{const data=await usePost("web/forms/"+formKey.value,record.value);if(form.value.reset(),data.id&&(formKey.value=data.id),data.action)if(data.action.type==="message"&&data.action.value){const re=/<script>(.*?)<\/script>/gs,matches=re.exec(data.action.value);if(matches){msgAction.value=data.action.value.replace(matches[0],"");try{eval(matches[1])}catch(e){console.error(e)}}else msgAction.value=data.action.value}else data.action.type==="redirect"?window.location=data.action.value:data.action.type==="reset"&&data.action.value&&useToastSuccess(data.action.value);else msgSuccess.length>0&&useToastSuccess(msgSuccess)}catch(e){}finally{loading.value=!1}}return(e,o)=>{const t=resolveComponent("Vueform");return openBlock(),createBlock(Transition,{mode:"out-in",name:"fade"},{default:withCtx(()=>[unref(msgAction)?(openBlock(),createElementBlock("div",{key:0,innerHTML:unref(msgAction)},null,8,_hoisted_1)):(openBlock(),createBlock(t,mergeProps({key:1,ref_key:"form",ref:form,modelValue:unref(record),"onUpdate:modelValue":o[0]||(o[0]=a=>isRef(record)?record.value=a:null)},unref(properties)),null,16,["modelValue"]))]),_:1})}}});document.addEventListener("DOMContentLoaded",()=>{const e=window.mmxForms.locale||"en";window.mmxForms.forms.forEach(o=>{createApp(_sfc_main,{id:o.id,schema:o.schema,locale:e}).use(vueform,vueFormConfig).use(src_default,toastOptions).mount("#mmx-forms-"+o.id)})});
